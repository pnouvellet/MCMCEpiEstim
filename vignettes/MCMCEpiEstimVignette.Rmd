---
title: "MCMCEpiEstim: package overview"
date: "`r Sys.Date()`"
output:
   rmarkdown::html_vignette:
     toc: true
     toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

*MCMCEpiEstim* allows:

- inferring Rt on multiple locations using EpiEstim independelty on each location.

- inferring Rt on multiple locations using an MCMC implementation of EpiEstim and allowing Rt variations 
to be the same/different across locations. The implementation can account for a given level reporting which may change over time. 

- jointly inferring Rt and the level of superspreading on multiple locations using an MCMC implementation of EpiEstim and allowing Rt variations to be the same/different across locations. The implementation can account for a given level reporting which may change over time.

In the 3 implementations:

- the serial interval is assumed to be the non-parametric version of EpiEstim,

- the time window can be sliding overlapping or non-overlapping (the latter returning estimates of Rt at the end of each time window),

- level of superspreading is always assumed constant over time and across locations.

Below, we provide a typical workflow for using the package

# Installing the package

To install the current stable, CRAN version of the package, type:
```{r install, eval=FALSE}
install.packages("MCMCEpiEstim")
```

To benefit from the latest features and bug fixes, install the development, *github* version of the package using:
```{r install2, eval=FALSE}
devtools::install_github("pnouvellet/MCMCEpiEstim",build = TRUE)
library(MCMCEpiEstim)
```

Note that this requires the package *devtools* installed.

# Simulating incidence data

This section illustrates how to simulate incidence data for a time-varying Rt, with a given level of reporting and superspreading.

```{r}

# a serial interal
si <- c(0,1)
# simualte an Rt
input <- data.frame(R_min = 0.95,
                    R_max = 1.1,
                    k = 1,
                    period = 24, 
                    step = 4,
                    I0 = 100,
                    pi = 0.5)
Rt <- Rt_linear(inp = input, n_week = input$period)
plot(Rt$t, Rt$Rt,type='l')
# set initial incidence
I0 <- incidence::as.incidence(x = input$I0, dates = 1, interval = 1)

# simulate for 10 locations
res <- MCMCEpiEstim::project_fct(I0 = I0,
                                 Rt = Rt,
                                 n_loc = 10,
                                 t_max = nrow(Rt),
                                 si = si,
                                 p = input$pi,
                                 model = 'negbin',
                                 over = input$k)

layout(matrix(1:2,nrow = 2))
matplot((res$I_true[,-1]), xlab = '', ylab = 'cases', main = 'true cases')
matplot((res$I_obs[,-1]), xlab = '', ylab = 'cases', main = 'observed cases')

```


# Inferring Rt using the multi-location EpiEstim


# Jointly inferring Rt and the level of superspreading 




